<% if @user.valid? %>
  location.href = '/users/notice?key=to_active'
<% elsif @user.errors.messages[:email].present? %>
  displayError($('#user_email'), '邮箱地址不合格或已存在')
<% elsif @user.errors.messages[:password].present? %>
  displayError($('#session_password'), '密码不符合规则')
<% end %>

function displayError(obj, message) {
    obj.parents('.form-item').addClass('form-item-error')
    obj.parents('.form-item').next().removeClass('hidden')
    obj.parents('.form-item').next().find('.error-message').text(message)
}